# ============================================================================
# GENERAL SETTINGS
# ============================================================================

set -g mouse on                        # enable mouse support for pane selection, resizing, and scrolling
set -g base-index 1                    # start indexing windows at 1 instead of 0
set -g pane-base-index 1               # start indexing panes at 1 instead of 0
set -g renumber-windows on             # renumber all windows when any window is closed
set -g detach-on-destroy off           # don't exit from tmux when closing a session
set -g history-limit 1000000           # increase history size (from 2,000)
set -g set-clipboard on                # use system clipboard
set -g status-position top             # macOS / darwin style
setw -g mode-keys vi                   # use vi mode keys

# ============================================================================
# TERMINAL SETTINGS
# ============================================================================

set -g default-terminal "${TERM}"                           # respect the TERM environment variable
set-option -g default-terminal 'screen-256color'            # set default terminal to support 256 colors
set-option -g terminal-overrides ',xterm-256color:RGB'      # enable true color (RGB) support

# Extended keys support for better keyboard handling
set -g extended-keys on                                     # enable extended keys in tmux
set -s extended-keys on                                     # enable extended keys at server level
set -as terminal-features 'xterm*:extkeys'                  # tell tmux that xterm-like terminals support extended keys
set -g extended-keys-format csi-u                           # use CSI u format for extended keys

# SSH environment variables
set -g update-environment "SSH_AUTH_SOCK SSH_CONNECTION SSH_CLIENT DISPLAY"  # preserve SSH agent and display variables when creating new sessions

# ============================================================================
# KEY BINDINGS
# ============================================================================

# Session and client management
bind ^X lock-server                                         # prefix + Ctrl-x: lock the tmux server
bind ^C new-window -c "$HOME"                               # prefix + Ctrl-c: create new window starting at home directory
bind ^D detach                                              # prefix + Ctrl-d: detach from current session
bind * list-clients                                         # prefix + *: list all clients connected to server

# Window navigation and management
bind H previous-window                                      # prefix + Shift-h: move to previous window
bind L next-window                                          # prefix + Shift-l: move to next window
bind r command-prompt "rename-window %%"                    # prefix + r: rename current window
bind '"' choose-window                                      # prefix + ": select window from list

# Pane management
bind s split-window -v -c "#{pane_current_path}"            # prefix + s: split pane horizontally (creates pane below)
bind v split-window -h -c "#{pane_current_path}"            # prefix + v: split pane vertically (creates pane to right)
bind | split-window                                         # prefix + |: split pane horizontally at home directory
# bind c kill-pane                                            # prefix + c: kill current pane
bind x swap-pane -D                                         # prefix + x: swap current pane with next pane

# Pane navigation (vim-style)
bind h select-pane -L                                       # prefix + h: select pane to the left
bind j select-pane -D                                       # prefix + j: select pane below
bind k select-pane -U                                       # prefix + k: select pane above
bind l select-pane -R                                       # prefix + l: select pane to the right

# Pane resizing
bind -r -T prefix , resize-pane -L 20                       # prefix + , (repeatable): resize pane 20 cells left
bind -r -T prefix . resize-pane -R 20                       # prefix + . (repeatable): resize pane 20 cells right
bind -r -T prefix - resize-pane -D 7                        # prefix + - (repeatable): resize pane 7 cells down
bind -r -T prefix = resize-pane -U 7                        # prefix + = (repeatable): resize pane 7 cells up

# Utilities
bind : command-prompt                                       # prefix + :: open command prompt
bind * setw synchronize-panes                               # prefix + *: toggle synchronized input to all panes
bind P set pane-border-status                               # prefix + Shift-p: toggle pane border status
bind S choose-session                                       # prefix + Shift-s: select session from list
bind R source-file ~/.tmux.conf \; display-message "Config reloaded"  # prefix + Shift-r: reload tmux configuration
bind K send-keys "clear"\; send-keys "Enter"                # prefix + Shift-k: clear terminal screen
bind l refresh-client                                       # prefix + l: refresh tmux client display

# Copy mode (vi-style)
bind-key -T copy-mode-vi v send-keys -X begin-selection     # v in copy mode: begin selection (like visual mode in vim)

# ============================================================================
# PLUGINS
# ============================================================================

set -g @plugin 'tmux-plugins/tpm'                           # tmux plugin manager
set -g @plugin 'catppuccin/tmux'                            # catppuccin theme for tmux

# ============================================================================
# THEME CONFIGURATION (CATPPUCCIN)
# ============================================================================

set -g @catppuccin_flavor "mocha"                           # use catppuccin mocha color scheme (dark theme)
set -g @catppuccin_status_background "none"                 # transparent status bar background
set -g @catppuccin_window_status_style "none"               # disable default window status styling
set -g @catppuccin_pane_status_enabled "off"                # disable pane status indicators
set -g @catppuccin_pane_border_status "yes"                 # enable pane border status

# ============================================================================
# STATUS BAR
# ============================================================================

set -g status-style "bg=default"                            # transparent status bar background
set -g status-justify "absolute-centre"                     # center the window list in status bar

# Status left
set -g status-left-length 100                               # allow status left to be up to 100 characters
set -g status-left ""                                       # initialize status left as empty
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=#{@thm_bg},bold]  #S },#{#[bg=default,fg=#{@thm_green}]  #S }}"  # session name, red when prefix key pressed, green otherwise
set -ga status-left "#[bg=default,fg=#{@thm_overlay_0},none]│"  # separator
set -ga status-left "#[bg=default,fg=#{@thm_maroon}]  #{pane_current_command} "  # current command running in pane
set -ga status-left "#[bg=default,fg=#{@thm_overlay_0},none]│"  # separator
set -ga status-left "#[bg=default,fg=#{@thm_blue}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "  # current directory (truncated to 32 chars, replace username with ~)
set -ga status-left "#[bg=default,fg=#{@thm_overlay_0},none]#{?window_zoomed_flag,│,}"  # separator (only shown when zoomed)
set -ga status-left "#[bg=default,fg=#{@thm_yellow}]#{?window_zoomed_flag,  zoom ,}"  # zoom indicator (only shown when zoomed)

# Status right
set -g status-right-length 100                              # allow status right to be up to 100 characters
set -g status-right ""                                      # initialize status right as empty
set -ga status-right "#[bg=default,fg=#{@thm_overlay_0}, none]│"  # separator
set -ga status-right "#[bg=default,fg=#{@thm_blue}] 󰭦 %m-%d 󰅐 %H:%M "  # date and time display

# ============================================================================
# PANE STYLING
# ============================================================================

set -g pane-active-border-style 'fg=magenta,bg=default'     # active pane border: magenta foreground, transparent background
set -g pane-border-style 'fg=brightblack,bg=default'       # inactive pane border: bright black foreground, transparent background

setw -g pane-border-status top                              # show pane border status at the top
setw -g pane-border-format ""                               # empty pane border format (no text)
setw -g @catppuccin_pane_active_border_style "##{?pane_in_mode,fg=#{@thm_lavender},##{?pane_synchronized,fg=#{@thm_mauve},fg=#{@thm_lavender}}}"  # active border: lavender in copy mode, mauve when synchronized
setw -g pane-border-style "bg=default,fg=#{@thm_surface_1}"  # inactive border: catppuccin surface_1 color
setw -g pane-border-lines single                            # use single line characters for pane borders

# ============================================================================
# WINDOW STYLING
# ============================================================================

set -wg automatic-rename on                                 # automatically rename windows based on running program
set -g automatic-rename-format "Window"                     # default name for windows is "Window"

# Default window style
set -g window-status-format " #I#{?#{!=:#{window_name},Window},: #W,} "  # format: window number, optionally with name if not "Window"
set -g window-status-style "bg=default,fg=#{@thm_rosewater}"  # inactive window: transparent background, rosewater foreground
set -g window-status-last-style "bg=default,fg=#{@thm_peach}"  # last window: transparent background, peach foreground
set -g window-status-activity-style "bg=#{@thm_red},fg=#{@thm_bg}"  # window with activity: red background
set -g window-status-bell-style "bg=#{@thm_red},fg=#{@thm_bg},bold"  # window with bell: red background, bold
set -gF window-status-separator "#[bg=default,fg=#{@thm_overlay_0}]│"  # separator between windows

# Current window style
set -g window-status-current-format " #I#{?#{!=:#{window_name},Window},: #W,} "  # format: window number, optionally with name if not "Window"
set -g window-status-current-style "bg=#{@thm_peach},fg=#{@thm_bg},bold"  # current window: peach background, bold text

# ============================================================================
# PLUGIN MANAGER INITIALIZATION
# ============================================================================

# Bootstrap TPM if not installed
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"


# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'                               # run TPM - must be at the end of config

